<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>방태모의 블로그: ggplot2 컬러링 가이드</title>

<meta property="description" itemprop="description" content="더 적은 수의 컬러로 직관적인 시각화를 수행하는 방법"/>

<link rel="canonical" href="https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/"/>
<link rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"/>
<link rel="icon" type="image/png" href="../../images/favicon.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2022-08-14"/>
<meta property="article:created" itemprop="dateCreated" content="2022-08-14"/>
<meta name="article:author" content="Taemo Bang"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="방태모의 블로그: ggplot2 컬러링 가이드"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="더 적은 수의 컬러로 직관적인 시각화를 수행하는 방법"/>
<meta property="og:url" content="https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/"/>
<meta property="og:image" content="https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/preview.jpg"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="방태모의 블로그"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="방태모의 블로그: ggplot2 컬러링 가이드"/>
<meta property="twitter:description" content="더 적은 수의 컬러로 직관적인 시각화를 수행하는 방법"/>
<meta property="twitter:url" content="https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/"/>
<meta property="twitter:image" content="https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/preview.jpg"/>
<meta property="twitter:site" content="@TaemoBang"/>
<meta property="twitter:creator" content="@TaemoBang"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="방태모의 블로그: ggplot2 컬러링 가이드"/>
<meta name="citation_fulltext_html_url" content="https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2022/08/14"/>
<meta name="citation_publication_date" content="2022/08/14"/>
<meta name="citation_author" content="Taemo Bang"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=4 Ways to use colors in ggplot more efficiently;citation_publication_date=2022;citation_author=Albert Rapp"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","draft","preview","creative_commons","twitter","categories","bibliography","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["ggplot2 컬러링 가이드"]},{"type":"character","attributes":{},"value":["더 적은 수의 컬러로 직관적인 시각화를 수행하는 방법"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","URL"]}},"value":[{"type":"character","attributes":{},"value":["Taemo Bang"]},{"type":"character","attributes":{},"value":["https://twitter.com/TaemoBang"]}]}]},{"type":"character","attributes":{},"value":["2022-08-14"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[2]}]}]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["preview.jpg"]},{"type":"character","attributes":{},"value":["CC BY-NC"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["site","creator"]}},"value":[{"type":"character","attributes":{},"value":["@TaemoBang"]},{"type":"character","attributes":{},"value":["@TaemoBang"]}]},{"type":"character","attributes":{},"value":["Visualization"]},{"type":"character","attributes":{},"value":["references.bib"]},{"type":"character","attributes":{},"value":["https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/"]},{"type":"character","attributes":{},"value":["https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["coloring-guide-for-ggplot2_files/anchor-4.2.2/anchor.min.js","coloring-guide-for-ggplot2_files/bowser-1.9.3/bowser.min.js","coloring-guide-for-ggplot2_files/clipboard-2.0.6/clipboard.min.js","coloring-guide-for-ggplot2_files/distill-2.2.21/template.v2.js","coloring-guide-for-ggplot2_files/figure-html5/mpg1-1.png","coloring-guide-for-ggplot2_files/figure-html5/mpg2-1.png","coloring-guide-for-ggplot2_files/figure-html5/mpg3-1.png","coloring-guide-for-ggplot2_files/figure-html5/mpg4-1.png","coloring-guide-for-ggplot2_files/figure-html5/mpg5-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend_label1-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend_label2-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend_label3-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend_label4-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend1-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend2-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend3-1.png","coloring-guide-for-ggplot2_files/figure-html5/spend4-1.png","coloring-guide-for-ggplot2_files/header-attrs-2.14/header-attrs.js","coloring-guide-for-ggplot2_files/jquery-3.6.0/jquery-3.6.0.js","coloring-guide-for-ggplot2_files/jquery-3.6.0/jquery-3.6.0.min.js","coloring-guide-for-ggplot2_files/jquery-3.6.0/jquery-3.6.0.min.map","coloring-guide-for-ggplot2_files/popper-2.6.0/popper.min.js","coloring-guide-for-ggplot2_files/tippy-6.2.7/tippy-bundle.umd.min.js","coloring-guide-for-ggplot2_files/tippy-6.2.7/tippy-light-border.css","coloring-guide-for-ggplot2_files/tippy-6.2.7/tippy.css","coloring-guide-for-ggplot2_files/tippy-6.2.7/tippy.umd.min.js","coloring-guide-for-ggplot2_files/webcomponents-2.0.0/webcomponents.js","coloring-guide-for-ggplot2_files/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css","coloring-guide-for-ggplot2_files/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js","preview.jpg","references.bib","time-spent-with-relationships-by-age-us.csv"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
        var fn = $(this).children()[0]
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">@import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

:root {
  --font-body:   inter,-apple-system,BlinkMacSystemFont,roboto,segoe ui,Helvetica,Arial,sans-serif;
  --font-header: Rubik,Tahoma,"Helvetica Neue",Helvetica,Arial,sans-serif;
  --font-mono:   SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
}

//* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    var(--font-header);
  --mono-font:       var(--font-mono);
  --body-font:       var(--font-body);
  --navbar-font:     var(--font-header);
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       #000;
  --text-size:        15px;
  --hover-color:      #ff6700;
  --bkgd-color:       white;
}

.distill-site-footer {
  --text-color:       #000;
  --text-size:        15px;
  --hover-color:      #ff6700;
  --bkgd-color:       white;
}


/* For floating images - see lab page, for example */

.float-left img {
    float:left;
    padding: 5px 10px 5px 0px;
}

.float-right img {
    float:right;
    padding: 5px 0px 5px 10px;
}

/* For dropping a shadow behind images */
.shadow {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  text-align: center;
}

d-article img {
  margin-bottom: 10px;
}

/* Pubs page */

.pub {
    margin: 0 0 15px 0;
}

}

/* Code chunks */

d-article pre { /* Chunk output */
  border-radius: 5px; /* Rounded edges */
  font-size: 12px;
  color: #fff;
  background-color: #696969;
  padding: 5px 5px 5px 18px;
  overflow: auto !important;
}

d-article div.sourceCode pre { /* Chunk code */
  border-radius: 5px; /* Rounded edges */
  background-color: #fff;
  color: black;
  padding: 5px 5px 5px 18px;
  overflow: auto !important;
}

d-article div.sourceCode {
  background-color: transparent;
}

/* Link buttons */

.icon-link {
    background-color: var(--color-primary);
    color: var(--color-white);
    padding: 3px 5px 3px 5px;
    margin: 0 2px 0 2px;
    border-radius: 5px; /* Rounded edges */
}

.icon-link:hover {
    background-color: var(--color-secondary);
    color: var(--color-white);
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.14/header-attrs.js"></script>
  <script src="../../site_libs/clipboard-2.0.6/clipboard.min.js"></script>
  <link href="../../site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
  <script src="../../site_libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
  <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script>
   document.addEventListener("DOMContentLoaded", function () {
     if (!/posts/.test(location.pathname)) {
       return;
     }

     var script = document.createElement("script");
     script.src = "https://giscus.app/client.js";
     script.setAttribute("data-repo", "be-favorite/Distill");
     script.setAttribute("data-repo-id", "R_kgDOG6lkPQ");
     script.setAttribute("data-category", "Comments");
     script.setAttribute("data-category-id", "DIC_kwDOG6lkPc4CN5yQ");
     script.setAttribute("data-mapping", "pathname");
     script.setAttribute("data-reactions-enabled", "1");
     script.setAttribute("data-emit-metadata", "0");
     script.setAttribute("data-theme", "light");
     script.setAttribute("data-lang", "ko");

     /* wait for article to load, append script to article element */
     var observer = new MutationObserver(function (mutations, observer) {
       var article = document.querySelector("d-article");
       if (article) {
         observer.disconnect();
         /* HACK: article scroll */
         article.setAttribute("style", "overflow-y: hidden");
         article.appendChild(script);
       }
     });

     observer.observe(document.body, { childList: true });
   });
 </script>

<script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-1QHE9697JG"></script>
<script type="text/javascript" cookie-consent="tracking">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1QHE9697JG');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"ggplot2 컬러링 가이드","description":"더 적은 수의 컬러로 직관적인 시각화를 수행하는 방법","authors":[{"author":"Taemo Bang","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-08-14T00:00:00.000+09:00","citationText":"Bang, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">방태모의 블로그</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">홈</a>
<a href="../../blog.html">블로그</a>
<a href="../../archive.html">아카이브</a>
<a href="https://taemobang.notion.site">이력서</a>
<a href="../../subscribe.html">구독</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>ggplot2 컬러링 가이드</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../blog.html#category:Visualization" class="dt-tag">Visualization</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>더 적은 수의 컬러로 직관적인 시각화를 수행하는 방법</p></p>
</div>

<div class="d-byline">
  Taemo Bang  
  
<br/>2022-08-14
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#준비하기" id="toc-준비하기">준비하기</a></li>
<li><a href="#음영을-활용하자" id="toc-음영을-활용하자">음영을
활용하자</a></li>
<li><a href="#음영만으로는-부족해"
id="toc-음영만으로는-부족해">음영만으로는 부족해</a></li>
<li><a href="#전달하고-싶은-내용만-강조하자"
id="toc-전달하고-싶은-내용만-강조하자">전달하고 싶은 내용만
강조하자</a></li>
<li><a href="#라벨링-활용하기" id="toc-라벨링-활용하기">라벨링
활용하기</a></li>
<li><a href="#맺음-말" id="toc-맺음-말">맺음 말</a></li>
</ul>
</nav>
</div>
<p><a
href="https://unsplash.com/photos/46juD4zY1XA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink"><img
src="preview.jpg" width="700"
alt="Photo by David Pisnoy on Unsplash" /></a></p>
<p>오늘은 <code>ggplot2</code>에서 더 적은 수의 컬러로 더 직관적인
시각화를 가능하게끔 해주는 4가지 방식에 대해 소개해보려고 합니다.
<code>ggplot2</code>를 바탕으로 진행되는 예제이긴 하나, 본 글에서 소개할
방식들에 담겨있는 아이디어는 언어, 시각화 라이브러리를 막론하고 적용이
가능할거라고 봅니다.물론, <code>ggplot2</code>만큼 짧고 가독성 좋은
코드로 구현이 가능할지는 미지수이지만요.😁 본 글에서
<code>ggplot2</code>의 그래프 문법 <a href="#fn1" class="footnote-ref"
id="fnref1" role="doc-noteref"><sup>1</sup></a>이 갖는 강력한 힘을
확인하실 수 있을 겁니다.</p>
<aside>
본 글은 <span class="citation" data-cites="rapp2022">(<a
href="#ref-rapp2022" role="doc-biblioref">Rapp 2022</a>)</span>를
기반으로 작성되었습니다.
</aside>
<p>대중들은 말이 아닌 그림을 기억합니다. 그래서, 잘 만들어진 데이터
시각화는 강력한 힘을 갖습니다. 종종 데이터 시각화를 하시다가 지나치게
많은 색을 사용하게 되어 오히려 전달력이 떨어진다는 느낌을 받은 적이 있지
않으신가요? 그렇다면 이 글이 도움이 되실 수도 있겠습니다.😀</p>
<h2 id="준비하기">준비하기</h2>
<p>본격적인 시작 전 몇 가지 준비를 하고자 합니다.
<code>ggplot2</code>에서 제공하는 다양한 테마 중
<code>theme_minimal()</code>을 사용할 예정이고, 폰트, 그림 제목과 색
등에 몇 가지 조정을 줄 예정입니다:</p>
<ul>
<li><p><code>showtext</code> 패키지를 통해 <a
href="https://fonts.google.com/specimen/Fira+Sans">Fira Sans font</a>
설정</p></li>
<li><p>그림 제목은 기본 좌측 정렬, 색맹(color-blind)까지 고려한 <a
href="https://jfly.uni-koeln.de/color/">Okabe Ito</a> 컬러 팔레트
사용</p>
<ul>
<li>본 글의 작성에 참고한 원 글의 저자는 <a
href="https://clauswilke.com/dataviz/">Fundamentals of Data
Visualization by Claus Wilke</a>를 읽은 뒤, Okabe Ito 컬러 팔레트를
선호하게 되었다고 합니다.</li>
</ul></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/showtext'>showtext</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add_google.html'>font_add_google</a></span><span class='op'>(</span><span class='st'>"Fira Sans"</span>, <span class='st'>"firasans"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>theme_customs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>  text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>'firasans'</span>, size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,</span>
<span>  plot.title.position <span class='op'>=</span> <span class='st'>'plot'</span>,</span>
<span>  plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>    face <span class='op'>=</span> <span class='st'>'bold'</span>, </span>
<span>    colour <span class='op'>=</span> <span class='fu'>thematic</span><span class='fu'>::</span><span class='fu'><a href='https://rstudio.github.io/thematic/reference/okabe_ito.html'>okabe_ito</a></span><span class='op'>(</span><span class='fl'>8</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>6</span><span class='op'>]</span>,</span>
<span>    margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>2</span>, r <span class='op'>=</span> <span class='fl'>0</span>, b <span class='op'>=</span> <span class='fl'>7</span>, l <span class='op'>=</span> <span class='fl'>0</span>, unit <span class='op'>=</span> <span class='st'>"mm"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>theme_set</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>theme_customs</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 id="음영을-활용하자">음영을 활용하자</h2>
<p><code>ggplot2</code> 패키지에서 제공하는 <code>mpg</code> 데이터셋을
이용해 연도별 자동차 종류의 빈도를 시각화해봅시다. 전에 충분히
보셨을만한 데이터라 생각해서, 데이터셋에 관한 설명은 스킵하겠습니다.
이런 방식으로 시각화를 해보신 경험이 있으실겁니다:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>mpg</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='va'>class</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"year"</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/mpg1-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>자동차 종류가 많다보니 무려 7개의 컬러를 시각화에 사용하였습니다. 이
그림이 틀렸다고 할 수는 없습니다. 다만, 좋은 시각화라고 할 수 있는지에
대해 한 번 생각해보자는 겁니다. 제가 보기에 이렇게나 많은 수의 컬러를
사용하는 시각화는 꽤나 정신없어 보인다고 느껴집니다.여러 수준을 갖는
범주형 변수에 관한 컬러링에 있어서 더 적은, 최대 3개 정도의 컬러만
사용하여 시각화를 수행하는 방법은 없을까요? 이제 그 아이디어를
소개하고자 합니다. 자동차 종류를 구분하기 위해 색조(hues) 뿐만이 아닌,
음영(shades)을 활용하는 것이죠. 3가지 컬러만을 사용해 투명도를 줌으로써
7개의 자동차 종류를 구분해보겠습니다. 미리 말씀드리자면,
<code>minivan</code>을 단독 하나의 그룹으로 설정해주어 이를 중심으로
투명도가 줄어들고 늘어나게끔 만드는 것이 키 아이디어입니다.</p>
<p>이를 위해서는 우선 데이터에 자동차의 종류를 3가지로 구분짓는 새로운
그룹 변수를 생성해주어야 합니다:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Group classes into three groups (to reduce colors to 3)</span></span>
<span><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>mpg</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    year <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    class_group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>class</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'2seater'</span>, <span class='st'>'compact'</span>, <span class='st'>'midsize'</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"grp1"</span>,</span>
<span>      <span class='va'>class</span> <span class='op'>==</span> <span class='st'>'minivan'</span> <span class='op'>~</span> <span class='st'>"grp2"</span>,</span>
<span>      <span class='cn'>T</span> <span class='op'>~</span> <span class='st'>"grp3"</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>이를 바탕으로 우선 먼저 시각화를 해보죠:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>shades_plt</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>year</span>, fill <span class='op'>=</span> <span class='va'>class_group</span>, alpha <span class='op'>=</span> <span class='va'>class</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='st'>'Year'</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>'Counts'</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='st'>'Class'</span>,</span>
<span>    title <span class='op'>=</span> <span class='st'>'Show shades, not hues'</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>shades_plt</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/mpg2-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>색조와 음영까지 활용해 3가지 컬러정도로 줄이긴 했지만, 아직 전달력은
매우 떨어집니다. 우리 눈으로 색조와 음영을 조합해 그림의 자동차 종류를
구분해내는 것은 꽤 어렵죠. 투명도와 색상을 직접 조정해보겠습니다.
투명도는 <code>suv</code> -&gt; <code>minivan</code>까지 점차 줄어들고,
<code>minvan</code> 이후부터는 다시 줄어든 양만큼 투명도가 늘어나도록
설정을 해주려고 합니다:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Color-blind safe colors</span></span>
<span><span class='va'>colors</span> <span class='op'>&lt;-</span>  <span class='fu'>thematic</span><span class='fu'>::</span><span class='fu'><a href='https://rstudio.github.io/thematic/reference/okabe_ito.html'>okabe_ito</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span></span>
<span><span class='co'># Possible levels of transparency (one for each class)</span></span>
<span><span class='va'>alpha_max</span> <span class='op'>&lt;-</span> <span class='fl'>1</span></span>
<span><span class='va'>alpha_min</span> <span class='op'>&lt;-</span> <span class='fl'>0.7</span></span>
<span><span class='va'>alpha_vals</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>alpha_max</span>, <span class='va'>alpha_min</span>, length.out <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>, </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>alpha_min</span>, <span class='va'>alpha_max</span>, length.out <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>]</span></span>
<span><span class='op'>)</span></span>
<span><span class='va'>alpha_vals</span></span></code></pre>
</div>
<pre><code>[1] 1.0 0.9 0.8 0.7 0.8 0.9 1.0</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Tweak previous plot</span></span>
<span><span class='va'>shades_plt</span> <span class='op'>&lt;-</span> <span class='va'>shades_plt</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>colors</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_alpha_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>alpha_vals</span><span class='op'>)</span></span>
<span><span class='va'>shades_plt</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/mpg3-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>아까보다는 좀 낫습니다. 여기서 좀 더 개선을 해보자구요. 우측 범례를
하나로 좀 통합해서 설정하면 좋을 것 같은데요. 7개로 구분되어 있는
투명도에 컬러를 입혀줘서 말이죠. 꽤나 어려운 작업일 것 같지만,
<code>ggplot2</code>에서는 아주 손쉬운 작업입니다. <code>guides()</code>
함수를 통해 가능합니다. <code>fill</code>에 관한
범례(<code>class_group</code>)는 삭제를 한 뒤에,
<code>guide_legend()</code>를 통해 <code>alpha</code>에 관한 범례에
<code>fill</code>의 색상을 가져와 우리가 사전에 설정한 각각 3개
그룹(<code>class_group</code>)의 컬러를 덮어씌워(override) 줄겁니다.
말이 조금 복잡해보이지만, 코드를 보면 더 쉽게 이해하실 수 있습니다:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>shades_plt</span> <span class='op'>&lt;-</span> <span class='va'>shades_plt</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span></span>
<span>    fill <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_none.html'>guide_none</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_legend.html'>guide_legend</a></span><span class='op'>(</span></span>
<span>      override.aes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>colors</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> </span>
<span><span class='va'>shades_plt</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/mpg4-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h2 id="음영만으로는-부족해">음영만으로는 부족해</h2>
<p>충분히 괜찮은 시각화를 했지만, 아쉬운 부분이 하나 있습니다. 인접한
컬러 블록들에서는 자동차 종류 구분이 쪼~금 불편해 보입니다. 이 문제 또한
손쉽게 해결해줄 수 있어요. 블록마다 선 하나씩만 그어주면 말이죠. 앞선
시각화 코드에 <code>geom_bar()</code> 한 줄이면 해결할 수 있습니다. 이
또한 그래프 문법의 힘이죠.😄</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>dat</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>year</span>, fill <span class='op'>=</span> <span class='va'>class_group</span>, alpha <span class='op'>=</span> <span class='va'>class</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>col <span class='op'>=</span> <span class='st'>'white'</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># Add lines for distinction</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>colors</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_alpha_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>alpha_vals</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span></span>
<span>    fill <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_none.html'>guide_none</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_legend.html'>guide_legend</a></span><span class='op'>(</span>override.aes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>colors</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='st'>'Year'</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>'Counts'</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='st'>'Class'</span>,</span>
<span>    title <span class='op'>=</span> <span class='st'>'Group categories together by color, \nbut keep showing them'</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/mpg5-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h2 id="전달하고-싶은-내용만-강조하자">전달하고 싶은 내용만
강조하자</h2>
<p>이제 조금 다른 이야기를 해보려고 합니다. 꼭 위와 같이 모든 범주에
대해 컬러를 줄 필요는 없는 상황도 있지 않을까요? 예를 들자면, 우리가
시각화를 통해 꼭 강조해서 전달하고 싶은 내용이 있을 때처럼요. 이번에
사용할 예시 데이터는 흥미로운 다양한 데이터셋을 제공해주는 <a
href="https://ourworldindata.org/time-with-others-lifetime">Our World in
Data</a>에서 가져왔습니다. 미국인들을 대상으로 설문조사를 수행한
자료인데요. 본 자료를 통해 우리가 알아보고자 하는 바는 “우리는 과연
일생동안 누구와 시간을 많이 보내는가?”입니다. 여러 나이대의 미국인들을
대상으로 하루에 평균적으로 누구와 얼마나 시간을 보내는지에 대해 조사한
자료라고 할 수 있겠습니다. 위 링크의 차트에 아래 우측 탭을 보시면
Download를 눌러서 데이터를 받으실 수 있습니다:</p>
<p>이 자료를 바탕으로 다음과 같은 그림을 그려볼 수 있습니다. 과연 나이에
따라 우리가 시간을 함께 보내는 대상은 어떤 식의 패턴을 보이며
변화할까요? 일반적으로는 다음과 같이 시각화를</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Some data wrangling</span></span>
<span><span class='va'>time_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>"./time-spent-with-relationships-by-age-us.csv"</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename_with</a></span><span class='op'>(</span></span>
<span>    <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Entitity'</span>, <span class='st'>'Code'</span>, <span class='st'>'Age'</span>, <span class='st'>'alone'</span>, <span class='st'>'friends'</span>, <span class='st'>'children'</span>, <span class='st'>'parents'</span>, </span>
<span>       <span class='st'>'partner'</span>, <span class='st'>'coworkers'</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span></span>
<span>    cols <span class='op'>=</span> <span class='va'>alone</span><span class='op'>:</span><span class='va'>coworkers</span>, </span>
<span>    names_to <span class='op'>=</span> <span class='st'>'person'</span>,</span>
<span>    values_to <span class='op'>=</span> <span class='st'>'minutes'</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>age</span> <span class='op'>&lt;=</span> <span class='fl'>80</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Color-blind safe colors</span></span>
<span><span class='va'>colors</span> <span class='op'>&lt;-</span> <span class='fu'>thematic</span><span class='fu'>::</span><span class='fu'><a href='https://rstudio.github.io/thematic/reference/okabe_ito.html'>okabe_ito</a></span><span class='op'>(</span><span class='fl'>7</span><span class='op'>)</span><span class='op'>[</span><span class='op'>-</span><span class='fl'>6</span><span class='op'>]</span></span>
<span></span>
<span><span class='co'># Line plot</span></span>
<span><span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>time_data</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>age</span>, y <span class='op'>=</span> <span class='va'>minutes</span>, col <span class='op'>=</span> <span class='va'>person</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>1.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>colors</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span>xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>15</span>, <span class='fl'>81</span><span class='op'>)</span>, expand <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>minor_breaks <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>'Age (in years)'</span>, y <span class='op'>=</span> <span class='st'>'Minutes'</span>, col <span class='op'>=</span> <span class='st'>'Time spent'</span><span class='op'>)</span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend1-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>보통 이렇게들 시각화하곤 하죠. 이런 종류의 그림은 스파게티
플롯(spaghetti plot)이라고 표현하기도 합니다. 우리는 또 수많은 컬러에
직면했습니다. 아울러, 이 그림 한 장만 놓고 봤을때는 무슨 말을 전달하고자
하는지 파악하기가 참 힘듭니다. 제 눈엔 우선 2가지 인사이트가
보입니다:</p>
<ol type="1">
<li>우리는 일생동안 혼자서 가장 많은 시간을 보내게 된다.</li>
<li>40대 즈음해서 아이와 보내는 시간은 줄어들면서, 혼자 보내는 시간이
많아진다.</li>
</ol>
<p>이와 같이 만약 우리가 전달하고자 하는 인사이트가 확실한 상태라면,
중요한 부분만 강조함으로써 이 지저분한 스파게티 플롯을 전달력 있는
깔끔한 스파게티 플롯으로 만들어 줄 수 있습니다.
<code>ggplothighlight</code> 패키지가 그 해결책이 되어줍니다. 패키지
안의 <code>ggplothighlight()</code> 함수를 이용해 레이어를 하나더
얹어서, 필터링을 해줄 수 있어요. 아주 편리한 패키지죠. 특정 조건을
만족하지 않는 데이터 포인트는 모조리 회색으로 표현이 됩니다. 먼저 첫
번째 인사이트를 그림으로 표현해봅시다. 코드 1줄 정도만 추가해주면
가능합니다.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yutannihilation/gghighlight/'>gghighlight</a></span><span class='op'>)</span></span>
<span><span class='va'>alone_plt</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/gghighlight/man/gghighlight.html'>gghighlight</a></span><span class='op'>(</span><span class='va'>person</span> <span class='op'>==</span> <span class='st'>'alone'</span>, use_direct_label <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>'Emphasize just one or a few categories'</span><span class='op'>)</span></span>
<span><span class='va'>alone_plt</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend2-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>이 그림에 텍스트를 추가하여 우리가 하고싶은 이야기를 좀 더 강조할
수도 있습니다:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alone_plt</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>'text'</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>455</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>'We spend a lot of time alone...'</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>7</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend3-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>하고 싶은 이야기가 하나가 아니라 여러개라면 어떤 방법이 있을까요?
전혀 문제가 되지 않습니다.😀 <code>gghighlight()</code>를 사용해 그저
여러 조건 넣어주기만 하면 됩니다.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>age_40_plt</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/gghighlight/man/gghighlight.html'>gghighlight</a></span><span class='op'>(</span></span>
<span>    <span class='va'>person</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'alone'</span>, <span class='st'>'children'</span><span class='op'>)</span>, </span>
<span>    <span class='va'>age</span> <span class='op'>&gt;=</span> <span class='fl'>38</span>, </span>
<span>    use_direct_label <span class='op'>=</span> <span class='cn'>F</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>38</span>, xend <span class='op'>=</span> <span class='fl'>38</span>, y <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, yend <span class='op'>=</span> <span class='fl'>300</span>, linetype <span class='op'>=</span> <span class='fl'>2</span>, col <span class='op'>=</span> <span class='st'>'grey20'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>'Emphasize just one or a few categories'</span><span class='op'>)</span> </span>
<span></span>
<span><span class='va'>age_40_plt</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>'text'</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>403</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>'Around the age of 40, we spend \nless time with children and \nmore time alone.'</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='fl'>0.85</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>5.5</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend4-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h2 id="라벨링-활용하기">라벨링 활용하기</h2>
<p>앞서 본 모든 그림들에서는 그림의 이해를 돕기위한 범례(legend)가
우측에 자리하고 있었습니다. 범례는 그림에서 꽤나 큰 공간을 차지합니다.
아울러, 범례는 그림에 집중도를 떨어뜨릴 수 있죠. 그림의 이해를 위해서는
필연적으로 범례와 그림을 번갈아가며 봐야하니까요. 이 문제를 해결할
방법은 없을까요? 범례를 없애고 그림에 라벨링을 통해 우리가 하고자 하는
이야기를 전달하면 어떨까요? 싱글 레이블에 대해서는
<code>annotate()</code>, 다중 레이블에 대해서는
<code>geom_text()</code>를 이용해 라벨링을 하면 되는데요. 우선
<code>annotate()</code>를 활용해 스파게티 플롯 예제를 개선시켜
보겠습니다:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alone_plt</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>'text'</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>455</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>'We spend a lot of time alone...'</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>7</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>'text'</span>, </span>
<span>    x <span class='op'>=</span> <span class='fl'>70</span>, </span>
<span>    y <span class='op'>=</span> <span class='fl'>420</span>, </span>
<span>    label <span class='op'>=</span> <span class='st'>'alone'</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>7</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>colors</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>'Label directly'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'none'</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend_label1-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>이러한 방식으로 공간도 세이브하고, 그림에 집중도도 훨씬 높혀줄 수
있죠. 범례와 플롯을 눈으로 왔다갔다 할 필요도 없고요. 여기서 조금 더
개선을 해볼까요? 현재 위 그림에는 alone이라는 단어가 중복으로
들어가있죠. 강조한 선 아래 alone을 없애고 선과 동일한 색상을 좌측 문장의
alone에 넣어주는 것은 어떨까요? 더 매력적인 시각화가 될 것만 같다는
생각이 들지 않나요?</p>
<p>이를 위해서는 <code>ggtext</code> 패키지를 활용해 HTML 문법을
이용해야합니다. <code>annotation()</code>의 <code>text</code> geom을
<code>richtext</code> geom으로 바꾸고, 우리가 컬러를 반영하고자 하는
텍스트에 대해서는 HTML 코드를 포함하는 문자열을 만들어 주는 과정이
필요합니다. 말이 좀 복잡해보이지만, 코드는 꽤 간단합니다:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span></span>
<span><span class='va'>color_alone</span> <span class='op'>&lt;-</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"We spend a lot of time &lt;span style = 'color:{colors[1]};'&gt;alone&lt;/span&gt;..."</span></span>
<span><span class='op'>)</span></span>
<span><span class='va'>color_alone</span></span></code></pre>
</div>
<pre><code>We spend a lot of time &lt;span style = &#39;color:#E69F00;&#39;&gt;alone&lt;/span&gt;...</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alone_plt</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>'Label directly'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>'richtext'</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>400</span>,</span>
<span>    label <span class='op'>=</span> <span class='va'>color_alone</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>6</span>,</span>
<span>    label.color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'none'</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend_label2-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>멋지지 않습니까? HTML 문법에 익숙하지 않은 분들은 컬러링을 넣어주는
형태를 기억하시기 바랍니다. 이런 식으로 직접적으로 라벨링 하는 방식은
스파게티 플롯 예제의 두 번째 인사이트를 나타내는 그림에 대해서도 손쉽게
적용이 가능합니다.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>age_40_text</span> <span class='op'>&lt;-</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"Around the age of 40, we spent &lt;br&gt; less time with </span></span>
<span><span class='st'>  &lt;span style = 'color:{colors[2]};'&gt;children&lt;/span&gt; </span></span>
<span><span class='st'>  and &lt;br&gt; more time &lt;span style = 'color:{colors[1]};'&gt;alone&lt;/span&gt;."</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>age_40_plt</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>'Label directly'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>'richtext'</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>350</span>,</span>
<span>    label <span class='op'>=</span> <span class='va'>age_40_text</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='fl'>1.25</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    label.color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'none'</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend_label3-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>이런 완성도 있는 시각화는 청중 또는 대중들에게 우리가 전달하고자 하는
이야기를 직관적으로 전달해줍니다. 범례와 플롯을 눈으로 왔다갔다 하는
피로를 덜어주는 것은 덤이고요.</p>
<p>마지막으로, 우리가 초기에 했던 예제인 막대그래프(bar chart) 예제에도
이를 적용해봅시다. 해당 예제의 경우 다중 레이블에 해당하므로
<code>annotate()</code>이 아닌 <code>geom_text()</code>가 필요로 됩니다.
그런데, 어떤 이유에서인지.. 자동차 종류의 각 레이블 위치가 정렬이 안되는
문제가 있었습니다. 불가피하게 연도별, 자동차 종류별 막대그래프의 높이를
누적빈도(<code>csum</code>)로 계산하고, 레이블이 들어갈
위치(<code>n</code>)를 적당하게 잡아주는 작업을 수행했습니다.🤯 코드가
조금 복잡해 보이긴 하나, 출력된 결과를 확인하시면 어떤 작업을 진행했는지
쉽게 이해하실 수 있을겁니다.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>manual_counts</span> <span class='op'>&lt;-</span> <span class='va'>mpg</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>class</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    year <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    class_group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>class</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'2seater'</span>, <span class='st'>'compact'</span>, <span class='st'>'midsize'</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"grp1"</span>,</span>
<span>      <span class='va'>class</span> <span class='op'>==</span> <span class='st'>'minivan'</span> <span class='op'>~</span> <span class='st'>"grp2"</span>,</span>
<span>      <span class='cn'>T</span> <span class='op'>~</span> <span class='st'>"grp3"</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> </span>
<span><span class='va'>manual_counts</span></span></code></pre>
</div>
<pre><code># A tibble: 14 × 4
   year  class          n class_group
   &lt;fct&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;      
 1 1999  2seater        2 grp1       
 2 1999  compact       25 grp1       
 3 1999  midsize       20 grp1       
 4 1999  minivan        6 grp2       
 5 1999  pickup        16 grp3       
 6 1999  subcompact    19 grp3       
 7 1999  suv           29 grp3       
 8 2008  2seater        3 grp1       
 9 2008  compact       22 grp1       
10 2008  midsize       21 grp1       
11 2008  minivan        5 grp2       
12 2008  pickup        17 grp3       
13 2008  subcompact    16 grp3       
14 2008  suv           33 grp3       </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>labels</span> <span class='op'>&lt;-</span> <span class='va'>manual_counts</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>class <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>class</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>year</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>class</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    csum <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, </span>
<span>    n <span class='op'>=</span> <span class='op'>(</span><span class='fu'>lag</span><span class='op'>(</span><span class='va'>csum</span>, default <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>csum</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>labels</span></span></code></pre>
</div>
<pre><code># A tibble: 14 × 5
# Groups:   year [2]
   year  class          n class_group  csum
   &lt;fct&gt; &lt;fct&gt;      &lt;dbl&gt; &lt;chr&gt;       &lt;int&gt;
 1 1999  suv         14.5 grp3           29
 2 1999  subcompact  38.5 grp3           48
 3 1999  pickup      56   grp3           64
 4 1999  minivan     67   grp2           70
 5 1999  midsize     80   grp1           90
 6 1999  compact    102.  grp1          115
 7 1999  2seater    116   grp1          117
 8 2008  suv         16.5 grp3           33
 9 2008  subcompact  41   grp3           49
10 2008  pickup      57.5 grp3           66
11 2008  minivan     68.5 grp2           71
12 2008  midsize     81.5 grp1           92
13 2008  compact    103   grp1          114
14 2008  2seater    116.  grp1          117</code></pre>
</div>
<p>레이블이 들어갈 자리를 계산하는 키 아이디어는 <code>lag()</code>를
통해서 계산한 누적빈도를 0값을 시작으로해서 한칸씩 당겨주고, 계산해둔
누적 빈도(<code>csum</code>)를 더하여 2로 나눠주는 것입니다. 이 작업을
수행하면 막대그래프를 구성하는 각 칸의 중간 높이를 계산할 수 있는
것이죠.</p>
<p>아울러, 우리가 본 시각화에서 한 가지 더 극복해야할 난관은 바로
자동차의 종류 중 <code>2seater</code>의 빈도가 매우 작아서 레이블이
들어갈 자리가 없는 점이 었습니다. 그래서, <code>2seater</code>의 경우
레이블을 막대의 맨 위에 표시되도록 하였습니다. 이러한 모든 난관들을
극복하고 완성한 그림을 공개합니다.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>manual_counts</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>year</span>, y <span class='op'>=</span> <span class='va'>n</span>, fill <span class='op'>=</span> <span class='va'>class_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='va'>class</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>'white'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>colors</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_alpha_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>alpha_vals</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='st'>'Year'</span>,</span>
<span>    y <span class='op'>=</span> <span class='st'>'Counts'</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='st'>'Class'</span>,</span>
<span>    title <span class='op'>=</span> <span class='st'>'Label directly'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'># Add all but one label</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>labels</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>class</span> <span class='op'>!=</span> <span class='st'>'2seater'</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>class</span><span class='op'>)</span>, </span>
<span>    col <span class='op'>=</span> <span class='st'>'white'</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>'bold'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'># Add 2seater label</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>labels</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>class</span> <span class='op'>==</span> <span class='st'>'2seater'</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>n</span> <span class='op'>+</span> <span class='fl'>3</span>, label <span class='op'>=</span> <span class='va'>class</span><span class='op'>)</span>, </span>
<span>    col <span class='op'>=</span> <span class='st'>'black'</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>'firasans'</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>'bold'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>'none'</span><span class='op'>)</span> </span></code></pre>
</div>
<p><img src="coloring-guide-for-ggplot2_files/figure-html5/spend_label4-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h2 id="맺음-말">맺음 말</h2>
<p>분석을 시작하며 혼자 가볍게 EDA를 하는 단계에서 본 예제와 같이
시각화를 개선해나가는 작업은 필요로 되지 않을겁니다. 오히려 시간
낭비일수도 있구요. 그러나, 내가 얻은 인사이트를 전달하는 자리 또는
데이터를 기반으로 누군가를 설득해야하는 자리에서는 이 글에서 제공하는 몇
가지 방법이 꽤나 도움이 될 것이라고 생각합니다. 물론, 전달하고자 하는
내용이 한 눈에 들어도록 시각화를 수행하는 작업은 의외로 쉬울 때도
있지만, 꽤나 까다로운 과정을 거쳐야하는 상황도 존재합니다. 실무에서는
이와는 또다른 예상치 못한 까다로운 문제들을 겪는 상황들이 있을 수도
있구요. 다만, 본 글에서 그림의 퀄리티를 단계단계 개선해나간 바와 같이
전달하고자 하는 내용을 명확히하고 충분한 시간을 숙고해 그림을 개선해
나간다면, 뭐든 해결할 수 있을 것이라고 봅니다. 하고자 하는 시각화를
구현하지 못해낸다고 하더라도 그 과정 속에서 배우는 것은 분명히 존재할
것입니다. 처음부터 완벽하게 아름다운 시각화를 해낼 수 있는 사람은 없다는
것을 기억하셨으면 합니다.😁</p>
<p>이번 포스팅을 준비하며 참고했던 글은 올해 봤던 데이터 시각화 관련
아티클 중 제게 가장 큰 임팩트를 주는 글이었습니다. 누구나 하는 평범한
시각화를 비범하게 만들어주는 글이라고 표현하면 적절할까요? 많은 사람들이
알았으면 하는 내용이라, 8월 서울 R 미트업에서 본 내용을 주제로 <a
href="https://be-favorite.github.io/Presentation_archive/coloring_guide/coloring_guide.html?fbclid=IwAR25qqDhVFzBVsp8u9PaV93pbzxA03wE8paPF0-u7oBVKFMT5gZtPCupono#1">발표</a>를
하기도 했습니다. 지금 이 글을 읽고 계신 여러분들에게도 좋은 인사이트를
줄 수 있는 글이 되었으면 합니다.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent"
role="doc-bibliography">
<div id="ref-rapp2022" class="csl-entry" role="doc-biblioentry">
Rapp, Albert. 2022. <span>“4 Ways to Use Colors in Ggplot More
Efficiently.”</span> <a
href="https://albert-rapp.de/posts/ggplot2-tips/07_four_ways_colors_more_efficiently/07_four_ways_colors_more_efficiently.html">https://albert-rapp.de/posts/ggplot2-tips/07_four_ways_colors_more_efficiently/07_four_ways_colors_more_efficiently.html</a>.
</div>
</div>
<section class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>🔗<a
href="http://aispiration.com/viz/viz-ggplot2-practice.html">그래프
문법이란?</a><a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=ggplot2%20%EC%BB%AC%EB%9F%AC%EB%A7%81%20%EA%B0%80%EC%9D%B4%EB%93%9C&amp;url=https%3A%2F%2Ftaemobang.com%2Fposts%2F2022-08-07-coloring-guide-for-ggplot2%2F" aria-label="share on twitter">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Ftaemobang.com%2Fposts%2F2022-08-07-coloring-guide-for-ggplot2%2F&amp;title=ggplot2%20%EC%BB%AC%EB%9F%AC%EB%A7%81%20%EA%B0%80%EC%9D%B4%EB%93%9C" aria-label="share on linkedin">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Ftaemobang.com%2Fposts%2F2022-08-07-coloring-guide-for-ggplot2%2F" aria-label="share on facebook">
        <i class="fab fa-facebook" aria-hidden="true"></i>
      </a>
    </span>
  </p>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/be-favorite/Distill/issues/new">create an issue</a> on the source repository.</p>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>. Source code is available at <a href="https://github.com/be-favorite/Distill">https://github.com/be-favorite/Distill</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Bang (2022, Aug. 14). 방태모의 블로그: ggplot2 컬러링 가이드. Retrieved from https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{bang2022ggplot2,
  author = {Bang, Taemo},
  title = {방태모의 블로그: ggplot2 컬러링 가이드},
  url = {https://taemobang.com/posts/2022-08-07-coloring-guide-for-ggplot2/},
  year = {2022}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
