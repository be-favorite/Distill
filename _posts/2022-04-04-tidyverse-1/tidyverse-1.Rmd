---
title: "데이터베이스에 tidyverse 사용하기 - 1편"
description: |
  R을 통해 데이터베이스 관련 작업을 한다면, 꼭 SQL 전문가가 될 필요는 없어요!
author:
    - name: Taemo Bang
      URL: https://twitter.com/TaemoBang
date: "2022-04-04"
output:
    distill::distill_article:
        self_contained: false
        toc: true
        toc_depth: 3
draft: TRUE
preview: preview.jpg
creative_commons: CC BY-NC
twitter:
    site: "@TaemoBang"
    creator: "@TaemoBang"
categories:
    - SQL
    - Databases
    - tidyverse
    - dbplyr
bibliography: references.bib
---

```{r distill-setup, include = FALSE}
# echo - Display code in output document (default = TRUE)
# eval - Run code in chunk (default = TRUE)
library(xaringanExtra)
library(rmarkdown)
xaringanExtra::use_clipboard()
```

[![Photo by Caspar Camille Rubin on Unsplash](preview.jpg){width="700"}](https://unsplash.com/photos/fPkvU7RDmCo?utm_source=unsplash&utm_medium=referral&utm_content=creditShareLink)

<aside>

본 글은 [@naidoo2020]를 기반으로 작성되었습니다.

</aside>

실무에서는 Data analyst, Data scientist를 가리지 않고 SQL에 관한 능력을 요구합니다. 우리나라의 채용공고를 둘러보면 Data analyst의 경우 특히 SQL에 대한 능력이 특별히 꼭 요구 되는 것 같습니다. 방대한 양의 데이터를 저장하고 관리하기 위해 실무에서는 데이터베이스를 사용합니다. 이 데이터베이스는 종종 관계형 데이터베이스 시스템[^1](이하 RDBMS)이라 불리기도 하죠. 그리고, 우리는 SQL[^2] 언어 또는 SQL을 조금 변형한(variant) 언어를 통해 이 데이터베이스와 이야기를 나눕니다. 여기서 변형을 고려한 이유는, RDBMS를 제공하는 업체에서 표준화된 SQL을 택하여 제공할 수도 있지만, 편의를 위해 표준화된 SQL을 조금 변형시켜 사용하는 경우도 있기 때문입니다.

[^1]: relational database management system, or RDBMS

[^2]: Structured Query Language

만약 이렇게 특정 업체로부터 제공되는 변형된 RDBMS를 사용해야한다면, 해당 업체에서 사용하는 특정 SQL을 사용해 쿼리를 작성하는 방법을 이해해야 하실겁니다. 변형된 RDBMS를 예로 들어보자면, [PostgreSQL](https://www.postgresql.org), [PrestoDB](https://prestodb.io)([AWS의 Athena](https://aws.amazon.com/ko/athena/?whats-new-cards.sort-by=item.additionalFields.postDateTime&whats-new-cards.sort-order=desc)를 위한) 등이 있습니다. PostgreSQL DB의 JSON 필드는 AWS에서 구조화된 중첩 배열로(array) 수집되므로, 동일한 필드를 쿼리할 때 다른 쿼리문을 사용합니다.

R을 사용하는 여러분 모두 잘 아시다시피, R에서는 `{dplyr}`[^3] 패키지를 통해 이러한 작업을 데이터에 수행할 수 있습니다. `{dplyr}`이 `select()`, `group_by()`, `left_join()` 등 SQL 문법을 잘 모방하긴 했지만, SQL 문법과 R 문법 사이를 완벽하게 왔다갔다 하기는 어렵습니다. 예를 들자면, `{dplyr}`의 `filter()`를 이용해 특정 행을 뽑아올 때, 우리는 R 문법을 따라야하므로 조건문에 `=`이 아닌 `==`을 사용하죠. 이는 SQL 문법과는 완벽히 다른 부분입니다.

[^3]: 명확하게 정해진 바는 없어보이나, d-plier라고 흔히 읽는 듯 합니다. 패키지의 스티커 이미지를 보면 플라이어가 그려져 있습니다.

자, 여기서 이러한 상황을 타개할 방법은 무엇일까요. 엄청난 용량의 데이터베이스를 R로 가져올 수는 없습니다. 메모리 베이스인 R에 이 짓을 햇다가는요? 생각도 하기 싫습니다.😰 그럼, RDBMS 환경에서 이러한 무거운 작업을(대부분 계산 행위) 수행하고 필요로 될 때에만 R에다가 가져오면 되지 않을까요? 예를 들면, 집계된 데이터를 가져와서 보고서용 그림을 그린다든지. 그렇습니다, 이를 가능하게끔 해주는 패키지에 대해 배워보려고 합니다.

본 튜토리얼에서는 `{dplyr}`의 데이터베이스 백엔드 버전이라 할 수 있는 `{dbplyr}` 패키지에 대해 배울거에요. `{dbplyr}`은 당신의 RDBMS에 R의 tidyverse 문법을 사용한 쿼리문을 직접적으로 사용할 수 있게끔 해줄겁니다.😀

## 1 데이터베이스 연결하기

먼저 필요한 패키지를 불러오죠. `install.packages("패키지명")`을 통해 설치할 수 있습니다.

```{r, warning=FALSE}
library(DBI)
library(dbplyr)
library(dplyr)
library(RSQLite)
library(odbc)
```

-   `{DBI}`: R의 데이터베이스 인터페이스에 관한 메인 패키지입니다.
-   `{dbplyr}`: `{dplyr}` 문법을 사용하여 데이터베이스에 질의를 할 수 있게끔 해줍니다.
-   `{dplyr}`: 데이터베이스에 질의할 때 사용할 패키지입니다.
-   `{RSQLite}`: 가벼운 단일 유저용 데이터베이스 SQLite DB에 연결할 수 있게끔 해주는 DBI[^4] 호환 패키지입니다. R-SQLite로 이해하시면 편합니다.
-   다른 DBI 용 호환 패키지가 필요할 수도 있습니다. 예를 들어, `{RPostgres}`는 PostgreSQL RDBMS와 연결을 해주는 패키지입니다.[^5]
-   `{odbc}`: odbc 드라이버를 사용해 RDBMS 인터페이스에 인터페이스할 수 있도록 해주는 DBI 호환 인터페이스입니다.[^6]

[^4]: DataBase Interface, 데이터베이스 인터페이스의 약어

[^5]: 본 예제에서는 다루지 않지만, [Rstudio DB](https://db.rstudio.com)에서 많은 것을 확인할 수 있습니다.

[^6]: 본 예제에서는 다루지 않지만, [Rstudio DB](https://db.rstudio.com)에서 확인할 수 있습니다.

### 우리가 사용할 데이터베이스
